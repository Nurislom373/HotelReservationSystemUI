<div class="hotels-page">
  <div class="page-header">
    <div>
      <h1 class="page-title">Hotels</h1>
      <p class="page-subtitle">Manage hotels and their configurations.</p>
    </div>
    <button class="btn-add" (click)="openAddModal()">
      <app-icon name="plus" size="16"></app-icon>
      Add Hotel
    </button>
  </div>

  <div class="filter-container">
    <div class="filter-icon">
      <app-icon name="filter" size="20" fill="#6b7280"></app-icon>
    </div>
    <input
      type="text"
      class="filter-input"
      placeholder="Search by name"
      [(ngModel)]="searchQuery"
      (ngModelChange)="onFilterChange()">
    <input
      type="text"
      class="filter-input"
      placeholder="Phone Number"
      [(ngModel)]="filterPhoneNumber"
      (ngModelChange)="onFilterChange()">
    <input
      type="text"
      class="filter-input"
      placeholder="Address"
      [(ngModel)]="filterAddress"
      (ngModelChange)="onFilterChange()">
  </div>

  <div class="table-container">
    <table class="hotels-table">
      <thead>
        <tr>
          <th>Hotel Name</th>
          <th>Type</th>
          <th>Address</th>
          <th>Phone Number</th>
          <th>Pet Accommodation</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let hotel of hotels">
          <td>
            <div class="hotel-name-cell">
              <div class="hotel-icon-wrapper">
                <app-icon name="bed" size="20" fill="#14b8a6"></app-icon>
              </div>
              <div>
                <div class="hotel-name">{{ hotel.name }}</div>
                <div class="hotel-location">{{ hotel.country }}, {{ hotel.state }}</div>
              </div>
            </div>
          </td>
          <td>{{ getHotelTypeLabel(hotel.type) }}</td>
          <td>{{ hotel.address }}</td>
          <td>{{ hotel.phoneNumber }}</td>
          <td>
            <span class="status-badge" [class.active]="hotel.petAccommodation">
              {{ hotel.petAccommodation ? 'Yes' : 'No' }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon" (click)="openViewModal(hotel)" aria-label="View">
                <app-icon name="eye" size="16"></app-icon>
              </button>
              <button class="btn-icon" (click)="openEditModal(hotel)" aria-label="Edit">
                <app-icon name="pencil" size="16"></app-icon>
              </button>
              <button class="btn-icon btn-icon-delete" (click)="openDeleteModal(hotel)" aria-label="Delete">
                <app-icon name="trash" size="16"></app-icon>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination-container">
    <button
      class="pagination-btn"
      [class.disabled]="currentPage === 1"
      (click)="previousPage()"
      [disabled]="currentPage === 1">
      < Previous
    </button>
    <div class="pagination-pages">
      <button
        *ngFor="let page of [].constructor(totalPages); let i = index"
        class="pagination-page"
        [class.active]="currentPage === (i + 1)"
        (click)="goToPage(i + 1)">
        {{ i + 1 }}
      </button>
    </div>
    <button
      class="pagination-btn"
      [class.disabled]="currentPage === totalPages"
      (click)="nextPage()"
      [disabled]="currentPage === totalPages">
      Next >
    </button>
  </div>

  <app-modal
    [isOpen]="isModalOpen"
    [title]="modalTitle"
    [size]="'lg'"
    (close)="closeModal()">
    <div *ngIf="selectedHotel" class="modal-form">
      <div class="form-group">
        <label>Name <span class="required">*</span></label>
        <input
          type="text"
          [(ngModel)]="selectedHotel!.name"
          [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
          [required]="isEditMode"
          class="form-input">
      </div>
      <div class="form-group">
        <label>Type</label>
        <select
          [(ngModel)]="selectedHotel!.type"
          [disabled]="!isEditMode && modalTitle === 'Hotel Details'"
          class="custom-select">
          <option *ngFor="let type of hotelTypes" [value]="type">
            {{ type }}
          </option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Country</label>
          <input
            type="text"
            [(ngModel)]="selectedHotel!.country"
            [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
            class="form-input">
        </div>
        <div class="form-group">
          <label>State</label>
          <input
            type="text"
            [(ngModel)]="selectedHotel!.state"
            [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
            class="form-input">
        </div>
      </div>
      <!-- Map Selector/Display -->
      <div class="form-group" *ngIf="isEditMode || (!isEditMode && modalTitle === 'Hotel Details')">
        <label *ngIf="isEditMode">Select Location on Map</label>
        <label *ngIf="!isEditMode && modalTitle === 'Hotel Details'">Location</label>
        <div class="map-container-wrapper">
          <div #mapContainer class="map-container"></div>
          <div *ngIf="isMapLoading" class="map-loading">
            <span>Loading address details...</span>
          </div>
        </div>
        <div class="map-hint" *ngIf="isEditMode">
          <app-icon name="info" size="14" fill="#6b7280"></app-icon>
          <span>Click on the map to select a location. Address fields will be automatically filled.</span>
        </div>
        <div class="map-hint" *ngIf="!isEditMode && modalTitle === 'Hotel Details' && selectedHotel && selectedHotel.latitude && selectedHotel.longitude">
          <app-icon name="info" size="14" fill="#6b7280"></app-icon>
          <span>Hotel location: {{ selectedHotel.latitude | number:'1.6-6' }}, {{ selectedHotel.longitude | number:'1.6-6' }}</span>
        </div>
        <div class="map-hint" *ngIf="!isEditMode && modalTitle === 'Hotel Details' && (!selectedHotel || !selectedHotel.latitude || !selectedHotel.longitude)">
          <app-icon name="info" size="14" fill="#6b7280"></app-icon>
          <span>No location coordinates available for this hotel.</span>
        </div>
      </div>

      <div class="form-group">
        <label>Address <span class="required">*</span></label>
        <input
          type="text"
          [(ngModel)]="selectedHotel!.address"
          [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
          [required]="isEditMode"
          class="form-input">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>District</label>
          <input
            type="text"
            [(ngModel)]="selectedHotel!.district"
            [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
            class="form-input">
        </div>
        <div class="form-group">
          <label>House</label>
          <input
            type="text"
            [(ngModel)]="selectedHotel!.house"
            [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
            class="form-input">
        </div>
        <div class="form-group">
          <label>Postal Code</label>
          <input
            type="text"
            [(ngModel)]="selectedHotel!.postalCode"
            [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
            class="form-input">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Latitude</label>
          <input
            type="number"
            [(ngModel)]="selectedHotel!.latitude"
            [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
            class="form-input">
        </div>
        <div class="form-group">
          <label>Longitude</label>
          <input
            type="number"
            [(ngModel)]="selectedHotel!.longitude"
            [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
            class="form-input">
        </div>
      </div>
      <div class="form-group">
        <label>Phone Number <span class="required">*</span></label>
        <input
          type="text"
          [(ngModel)]="selectedHotel!.phoneNumber"
          [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
          [required]="isEditMode"
          class="form-input">
      </div>
      <div class="form-group">
        <label>Logo Key</label>
        <input
          type="text"
          [(ngModel)]="selectedHotel!.logoKey"
          [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
          class="form-input">
      </div>
      <div class="form-group">
        <label>Pet Accommodation</label>
        <select
          [(ngModel)]="selectedHotel!.petAccommodation"
          [disabled]="!isEditMode && modalTitle === 'Hotel Details'"
          class="custom-select">
          <option [value]="false">No</option>
          <option [value]="true">Yes</option>
        </select>
      </div>
      <div class="form-group">
        <label>Days Off (comma-separated)</label>
        <input
          type="text"
          [value]="getDaysOffString()"
          (input)="setDaysOffString($any($event.target).value)"
          [readonly]="!isEditMode && modalTitle === 'Hotel Details'"
          class="form-input"
          placeholder="e.g., Monday, Tuesday">
      </div>
      <!-- Amenities Multi-Select -->
      <div class="form-group" *ngIf="isEditMode || modalTitle === 'Hotel Details'">
        <label>Amenities <span class="selected-count" *ngIf="selectedHotel && selectedHotel.amenities">({{ selectedHotel.amenities.length }})</span></label>
        
        <!-- Selected Amenities Display -->
        <div class="selected-items-container" *ngIf="selectedHotel && selectedHotel.amenities && selectedHotel.amenities.length > 0; else noAmenitiesSelected">
          <div *ngFor="let amenity of selectedHotel.amenities" class="selected-item-badge">
            <span>{{ amenity.name }}</span>
            <button 
              *ngIf="isEditMode"
              type="button"
              class="badge-remove-btn"
              (click)="removeAmenity(amenity)"
              aria-label="Remove amenity">
              <app-icon name="close" size="12" fill="#6b7280"></app-icon>
            </button>
          </div>
        </div>
        <ng-template #noAmenitiesSelected>
          <div class="no-items-message" *ngIf="isEditMode">No amenities selected. Use the dropdown below to add amenities.</div>
          <div class="no-items-message" *ngIf="!isEditMode">No amenities selected.</div>
        </ng-template>

        <!-- Multi-Select Dropdown (only in edit mode) -->
        <div class="multi-select-wrapper" *ngIf="isEditMode" #amenityDropdown>
          <div 
            class="multi-select-trigger"
            (click)="toggleAmenityDropdown()"
            [class.open]="isAmenityDropdownOpen">
            <span class="multi-select-placeholder">
              {{ amenitySearchQuery ? 'Searching...' : 'Search and select amenities' }}
            </span>
            <app-icon
              name="chevron-down"
              size="16"
              [className]="isAmenityDropdownOpen ? 'multi-select-chevron rotated' : 'multi-select-chevron'">
            </app-icon>
          </div>
          <div class="multi-select-dropdown" [class.open]="isAmenityDropdownOpen">
            <!-- Search Input -->
            <div class="multi-select-search">
              <app-icon name="search" size="16" fill="#6b7280"></app-icon>
              <input
                type="text"
                class="multi-select-search-input"
                placeholder="Search amenities..."
                [(ngModel)]="amenitySearchQuery"
                (click)="$event.stopPropagation()"
                (focus)="isAmenityDropdownOpen = true">
            </div>
            <!-- Amenities List -->
            <div class="multi-select-options">
              <div 
                *ngFor="let amenity of getFilteredAmenities()"
                class="multi-select-option"
                [class.selected]="isAmenitySelected(amenity)"
                (click)="toggleAmenity(amenity)">
                <div class="multi-select-option-content">
                  <input
                    type="checkbox"
                    [checked]="isAmenitySelected(amenity)"
                    (change)="toggleAmenity(amenity)"
                    (click)="$event.stopPropagation()"
                    class="multi-select-checkbox">
                  <span class="multi-select-option-label">{{ amenity.name }}</span>
                </div>
                <app-icon
                  *ngIf="isAmenitySelected(amenity)"
                  name="check-circle"
                  size="16"
                  fill="#14b8a6">
                </app-icon>
              </div>
              <div *ngIf="getFilteredAmenities().length === 0" class="multi-select-no-results">
                No amenities found
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Room Types Multi-Select -->
      <div class="form-group" *ngIf="isEditMode || modalTitle === 'Hotel Details'">
        <label>Room Types <span class="selected-count" *ngIf="selectedHotel && selectedHotel.roomTypes">({{ selectedHotel.roomTypes.length }})</span></label>
        
        <!-- Selected Room Types Display -->
        <div class="selected-items-container" *ngIf="selectedHotel && selectedHotel.roomTypes && selectedHotel.roomTypes.length > 0; else noRoomTypesSelected">
          <div *ngFor="let roomType of selectedHotel.roomTypes" class="selected-item-badge">
            <span>{{ roomType.name }}</span>
            <button 
              *ngIf="isEditMode"
              type="button"
              class="badge-remove-btn"
              (click)="removeRoomType(roomType)"
              aria-label="Remove room type">
              <app-icon name="close" size="12" fill="#6b7280"></app-icon>
            </button>
          </div>
        </div>
        <ng-template #noRoomTypesSelected>
          <div class="no-items-message" *ngIf="isEditMode">No room types selected. Use the dropdown below to add room types.</div>
          <div class="no-items-message" *ngIf="!isEditMode">No room types selected.</div>
        </ng-template>

        <!-- Multi-Select Dropdown (only in edit mode) -->
        <div class="multi-select-wrapper" *ngIf="isEditMode" #roomTypeDropdown>
          <div 
            class="multi-select-trigger"
            (click)="toggleRoomTypeDropdown()"
            [class.open]="isRoomTypeDropdownOpen">
            <span class="multi-select-placeholder">
              {{ roomTypeSearchQuery ? 'Searching...' : 'Search and select room types' }}
            </span>
            <app-icon
              name="chevron-down"
              size="16"
              [className]="isRoomTypeDropdownOpen ? 'multi-select-chevron rotated' : 'multi-select-chevron'">
            </app-icon>
          </div>
          <div class="multi-select-dropdown" [class.open]="isRoomTypeDropdownOpen">
            <!-- Search Input -->
            <div class="multi-select-search">
              <app-icon name="search" size="16" fill="#6b7280"></app-icon>
              <input
                type="text"
                class="multi-select-search-input"
                placeholder="Search room types..."
                [(ngModel)]="roomTypeSearchQuery"
                (click)="$event.stopPropagation()"
                (focus)="isRoomTypeDropdownOpen = true">
            </div>
            <!-- Room Types List -->
            <div class="multi-select-options">
              <div 
                *ngFor="let roomType of getFilteredRoomTypes()"
                class="multi-select-option"
                [class.selected]="isRoomTypeSelected(roomType)"
                (click)="toggleRoomType(roomType)">
                <div class="multi-select-option-content">
                  <input
                    type="checkbox"
                    [checked]="isRoomTypeSelected(roomType)"
                    (change)="toggleRoomType(roomType)"
                    (click)="$event.stopPropagation()"
                    class="multi-select-checkbox">
                  <span class="multi-select-option-label">{{ roomType.name }}</span>
                </div>
                <app-icon
                  *ngIf="isRoomTypeSelected(roomType)"
                  name="check-circle"
                  size="16"
                  fill="#14b8a6">
                </app-icon>
              </div>
              <div *ngIf="getFilteredRoomTypes().length === 0" class="multi-select-no-results">
                No room types found
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="isEditMode || modalTitle === 'Hotel Details'" class="form-actions">
        <button *ngIf="isEditMode" class="btn-primary" (click)="saveHotel()">Save</button>
        <button class="btn-secondary" (click)="closeModal()">Close</button>
      </div>
    </div>
  </app-modal>

  <!-- Delete Confirmation Modal -->
  <app-modal
    [isOpen]="isDeleteModalOpen"
    title="Delete Hotel"
    [size]="'sm'"
    (close)="closeDeleteModal()">
    <div class="delete-modal-content">
      <p class="delete-message">Are you sure you want to delete this hotel?</p>
      <div class="form-actions">
        <button class="btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn-danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </app-modal>
</div>

